<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="VALIDACION_ALERTAS_FN/report.js" type="text/javascript"></script>
<link href="VALIDACION_ALERTAS_FN/report.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="banner">
<table width="98%"><tr>
<td><h2 class="banner">VALIDACION_ALERTAS_FN</h2></td>
</tr></table></div>
<div id="maintabs">
<div class="currentmaintab" onclick="onSelectMainTab(this, 0)">
<div>
<p>Doc</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 1)">
<div>
<p>Details</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 2)">
<div>
<p>Grants</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 3)">
<div>
<p>References</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 4)">
<div>
<p>Dependencies</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 5)">
<div>
<p>Code</p>
</div>
</div>
</div>
<br/>
<div id="masterreports">
<div id="Master.0">
<div class="currentmasterreport">
<TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE><HR><P></P><HR><P></P><A NAME="method_summary"></A><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="3" BORDER="1"><TR CLASS="TableHeadingColor"><TD COLSPAN="2"><FONT SIZE="+2"><B>Method Summary</B></FONT></TD><TR CLASS="TableRowColor"><TD WIDTH="1%" VALIGN="top" ALIGN="right"><FONT SIZE="-1"><CODE>&nbsp;</CODE></FONT></TD><TD><CODE><B><A HREF="#"VALIDACION_ALERTAS_FN"">"VALIDACION_ALERTAS_FN"</A></B>( V_PERFIL IN VARCHAR2 , V_USUARIO IN VARCHAR2 , V_PRINCIPAL IN NUMBER , V_COOR_PRINCIPAL IN VARCHAR2 ) RETURN VARCHAR2 </CODE><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD></TR>
</TABLE>
<P></P><A NAME="method_detail"></A><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="3" BORDER="1"><TR CLASS="TableHeadingColor"><TD COLSPAN="2"><FONT SIZE="+2"><B>Method Detail</B></FONT></TD></TABLE><A NAME=""VALIDACION_ALERTAS_FN""></A>
<H3>"VALIDACION_ALERTAS_FN"</H3><PRE>          <B>"VALIDACION_ALERTAS_FN"</B>( V_PERFIL IN VARCHAR2 , V_USUARIO IN VARCHAR2 , V_PRINCIPAL IN NUMBER , V_COOR_PRINCIPAL IN VARCHAR2 ) RETURN VARCHAR2 </PRE><DL>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<DD><DL></DL></DD></DL><HR><TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE></div>
</div>
<div id="Master.1">
<div class="masterreport">
<table id="Table.0" cellpadding="0" cellspacing="0" summary="">
<th>NAME</th>
<th>VALUE</th>
</tr>
<tr>
<td>OWNER</td>
<td>PDB_CRONUS</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>VALIDACION_ALERTAS_FN</td>
</tr>
<tr>
<td>SUBOBJECT_NAME</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_ID</td>
<td>81333</td>
</tr>
<tr>
<td>DATA_OBJECT_ID</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_TYPE</td>
<td>FUNCTION</td>
</tr>
<tr>
<td>CREATED</td>
<td>29/07/22</td>
</tr>
<tr>
<td>LAST_DDL_TIME</td>
<td>10/02/25</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>2025-02-10:11:10:19</td>
</tr>
<tr>
<td>STATUS</td>
<td>INVALID</td>
</tr>
<tr>
<td>TEMPORARY</td>
<td>N</td>
</tr>
<tr>
<td>GENERATED</td>
<td>N</td>
</tr>
<tr>
<td>SECONDARY</td>
<td>N</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>1</td>
</tr>
<tr>
<td>EDITION_NAME</td>
<td>null</td>
</tr>
<tr>
<td>SHARING</td>
<td>NONE</td>
</tr>
<tr>
<td>EDITIONABLE</td>
<td>Y</td>
</tr>
<tr>
<td>ORACLE_MAINTAINED</td>
<td>N</td>
</tr>
<tr>
<td>APPLICATION</td>
<td>N</td>
</tr>
<tr>
<td>DEFAULT_COLLATION</td>
<td>USING_NLS_COMP</td>
</tr>
<tr>
<td>DUPLICATED</td>
<td>N</td>
</tr>
<tr>
<td>SHARDED</td>
<td>N</td>
</tr>
<tr>
<td>CREATED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>CREATED_VSNID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_VSNID</td>
<td>null</td>
</tr>
</table>
</div>
</div>
<div id="Master.2">
<div class="masterreport">
<table id="Table.1" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>PRIVILEGE</th>
<th>GRANTEE</th>
<th>GRANTABLE</th>
<th>GRANTOR</th>
<th>OBJECT_NAME</th>
</tr>
</table>
</div>
</div>
<div id="Master.3">
<div class="masterreport">
<table id="Table.2" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.4">
<div class="masterreport">
<table id="Table.3" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.5">
<div class="masterreport">
<pre>
FUNCTION "VALIDACION_ALERTAS_FN" (
    V_PERFIL         IN VARCHAR2,
    V_USUARIO        IN VARCHAR2,
    V_PRINCIPAL      IN NUMBER,
    V_COOR_PRINCIPAL IN VARCHAR2 )
  RETURN VARCHAR2
IS
  SQL_STR            VARCHAR2(2000) :='';   -- Query
  V_QUERY            VARCHAR2(2000) :='';   -- Fragmento Query
  V_ALERTAS          VARCHAR2(2000) := '0'; -- NumeroAlertas|ProyectosNuevosSistema|
  V_NUM_ALERTAS      NUMBER         := 0;   -- Numero de alertas
  V_CANT_COOR        NUMBER         := 0;   -- Numero de coordinaciones
  V_CANT_PRO_SIS     NUMBER         := 0;   -- Cantidad proyectos nuevos por sistema
  V_CANT_PRO_COO     NUMBER         := 0;   -- Cantidad proyectos nuevos por coordinacion
  V_CANT_COST_NEW    NUMBER         := 0;   -- Cantidad costos por crear
  V_CANT_EST_FAC     NUMBER         := 0;   -- Cantidad estados de entregables facturables
  V_CANT_PRO_FIC_SIS NUMBER         := 0;   -- Cantidad proyectos sin fichas relacionadas (Sistemas)
  V_CANT_PRO_FIC_COO NUMBER         := 0;   -- Cantidad proyectos sin fichas relacionadas (Coordinacion)
  V_CANT_IND_PEN_SIS NUMBER         := 0;   -- Cantidad indicadores pendientes por gestionar (Sistemas)
  V_CANT_IND_PEN_COO NUMBER         := 0;   -- Cantidad indicadores pendientes por gestionar (Coordinacion)
  V_CANT_GES_PRY_SIS NUMBER         := 0;   -- Cantidad actividades pendientes por gestion de pry, bolsa o frente (Sistemas)
  V_CANT_GES_PRY_COO NUMBER         := 0;   -- Cantidad actividades pendientes por gestion de pry, bolsa o frente (Coordinacion)
  -- CONSULTA PROYECTOS NUEVOS POR SISTEMA
  C_A CONSTANT VARCHAR2(27) :='([A-Z0-9]+)([^A-Z0-9]+)(.+)';
  C_B CONSTANT VARCHAR2(2)  :='\1';
  C_C CONSTANT VARCHAR2(12) :='([^A-Z0-9]+)';
  C_D CONSTANT VARCHAR2(2)  :='';
  C_E CONSTANT VARCHAR2(7)  :='([\s]+)';
  C_F CONSTANT VARCHAR2(2)  :=' ';
  C_G CONSTANT VARCHAR2(2)  :='0';
BEGIN
  -- CONSULTA PROYECTOS NUEVOS POR SISTEMA
  IF V_PERFIL = 'COORDINADOR' THEN
    V_QUERY  := 'WHERE S.SISTEMAS = '' ''';
  END IF;
SQL_STR := 'SELECT DISTINCT
COUNT(1)
FROM
( SELECT DISTINCT
/*+ ORDERED */
D.SISTEMAS,
S.RESPONSABLE,
P.PRY_REF
FROM BIT_DETALLE D
INNER JOIN BIT_PROYECTOS P
ON P.PRY_REF         IS NOT NULL
AND P.PRY_REF         &lt;> :G
AND P.PRY_REF           = TRIM(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(D.IDENTREGABLE,:A,:B),:C,:D),:E,:F))
AND (P.PROYECTO       IS NULL
OR P.AREA_SOLICITANTE IS NULL
OR P.PRIORIDAD        IS NULL
OR P.NEGOCIO2         IS NULL)
INNER JOIN BIT_SISTEMAS S
ON S.SISTEMAS=D.SISTEMAS
'||V_QUERY||'
)A';
EXECUTE IMMEDIATE SQL_STR INTO V_CANT_PRO_SIS USING C_G, C_A, C_B, C_C, C_D, C_E, C_F;
IF V_PERFIL = 'COORDINADOR' THEN
  -- CONSULTAR COORDINACIONES
  SELECT COUNT(1)
  INTO V_CANT_COOR
  FROM
    (SELECT
      /*+ RULE*/
      X.SISTEMAS
    FROM BIT_SISTEMAS X
    WHERE X.RESPONSABLE = V_USUARIO
    UNION
    SELECT
      /*+ RULE*/
      B.SISTEMAS
    FROM BIT_COORDINACION A
    INNER JOIN BIT_REL_SISTEMAS_GERENCIA B
    ON B.COORDINACION   = A.COORD
    WHERE A.RESPONSABLE = V_USUARIO
    );
  IF V_CANT_COOR > 0 THEN
    V_QUERY     := ' AND  SIS.SISTEMAS IN(
SELECT /*+ RULE*/ X.SISTEMAS
FROM BIT_SISTEMAS X
WHERE X.RESPONSABLE = '''||V_USUARIO||'''
UNION
SELECT /*+ RULE*/ B.SISTEMAS
FROM BIT_COORDINACION A
INNER JOIN BIT_REL_SISTEMAS_GERENCIA B
ON B.COORDINACION   = A.COORD
WHERE A.RESPONSABLE = '''||V_USUARIO||''')';
  ELSE
    V_QUERY := '';
  END IF;
  -- ACTIVIDADES DETALLES PENDIENTES POR GESTION DE PRY, BOLSA O FRENTE SISTEMAS
  SQL_STR := 'SELECT COUNT(1) FROM (
SELECT NOMBRE_SISTEMAS,
RESPONSABLESIS,
COUNT(1) CANTIDAD
FROM
(SELECT /*+ ORDERED */ COR.COORD NOMBRE_COORDINACION,
COR.RESPONSABLE RESPONSABLE_COR,
SIS.SISTEMAS NOMBRE_SISTEMAS ,
SIS.RESPONSABLE RESPONSABLESIS
FROM BIT_DETALLE DET
INNER JOIN BIT_SISTEMAS SIS
ON(SIS.SISTEMAS=DET.SISTEMAS)
INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
ON (SISCOR.SISTEMAS = SIS.SISTEMAS)
INNER JOIN BIT_COORDINACION COR
ON (COR.COORD      = SISCOR.COORDINACION)
WHERE (DET.FRENTE IS NULL
OR DET.BOLSA      IS NULL
OR DET.PRY        IS NULL)
'||V_QUERY||
  '
)
GROUP BY NOMBRE_SISTEMAS,  RESPONSABLESIS
)';
  EXECUTE IMMEDIATE SQL_STR INTO V_CANT_GES_PRY_SIS ;
  IF V_PRINCIPAL > 0 THEN
    -- ACTIVIDADES DETALLES PENDIENTES POR GESTION DE PRY, BOLSA O FRENTE COORDINACION
    SQL_STR := 'SELECT COUNT(1) FROM (SELECT /*+ RULE*/COR.COORD NOMBRE_COORDINACION,
COR.RESPONSABLE RESPONSABLE_COR,
COUNT(1) CANTIDAD
FROM BIT_DETALLE DET
INNER JOIN BIT_SISTEMAS SIS
ON(SIS.SISTEMAS=DET.SISTEMAS)
INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
ON (SISCOR.SISTEMAS = SIS.SISTEMAS)
INNER JOIN BIT_COORDINACION COR
ON (COR.COORD      = SISCOR.COORDINACION)
WHERE (DET.FRENTE IS NULL
OR DET.BOLSA      IS NULL
OR DET.PRY        IS NULL)
'||V_QUERY||'
GROUP BY COR.COORD,
COR.RESPONSABLE)';
    EXECUTE IMMEDIATE SQL_STR INTO V_CANT_GES_PRY_COO ;
  END IF;
  -- PROYECTOS NUEVOS POR COORDINACION
  SELECT COUNT(1)
  INTO V_CANT_PRO_COO
  FROM
    ( SELECT DISTINCT
      /*+ CHOOSE*/
      G.COORDINACION,
      c.RESPONSABLE,
      COUNT(1) CANTIDAD
    FROM BIT_DETALLE D
    INNER JOIN BIT_PROYECTOS P
    ON P.PRY_REF           = TRIM(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(D.IDENTREGABLE,C_A,C_B),C_C,C_D),C_E,C_F))
    AND P.PRY_REF         IS NOT NULL
    AND P.PRY_REF         &lt;> '0'
    AND (P.PROYECTO       IS NULL
    OR P.AREA_SOLICITANTE IS NULL
    OR P.PRIORIDAD        IS NULL
    OR P.NEGOCIO2         IS NULL)
    INNER JOIN BIT_SISTEMAS S
    ON S.SISTEMAS=D.SISTEMAS
    LEFT JOIN BIT_REL_SISTEMAS_GERENCIA G
    ON G.SISTEMAS=S.SISTEMAS
    LEFT JOIN BIT_COORDINACION c
    ON C.COORD           = G.COORDINACION
    WHERE G.COORDINACION = V_COOR_PRINCIPAL
    GROUP BY G.COORDINACION,
      c.RESPONSABLE
    );
  -- COMBINACION DE COSTOS POR CREAR
  SELECT COUNT(1)
  INTO V_CANT_COST_NEW
  FROM
    ( SELECT DISTINCT
      /*+ ORDERED */
      BOLSA,
      PRY,
      PROVEEDOR ,
      FRENTE,
      ANIO,
      TIPO
    FROM BIT_DETALLE
    WHERE SISTEMAS IN
      ( SELECT DISTINCT BS.SISTEMAS
      FROM BIT_SISTEMAS BS
      INNER JOIN BIT_REL_SISTEMAS_GERENCIA BSC
      ON BS.SISTEMAS = BSC.SISTEMAS
      INNER JOIN BIT_COORDINACION BC
      ON BC.COORD                       = BSC.COORDINACION
      WHERE TRIM(UPPER(BS.RESPONSABLE)) = TRIM(UPPER(V_USUARIO))
      OR TRIM(UPPER(BC.RESPONSABLE))    = TRIM(UPPER(V_USUARIO))
      )
    MINUS
    SELECT DISTINCT
      /*+ RULE*/
      BOLSA,
      PRY,
      PROVEEDOR ,
      FRENTE,
      ANIO,
      TIPO
    FROM BIT_COSTOS
    );
  -- PROYECTOS SIN FICHAS RELACIONADAS (SISTEMAS)
  SELECT COUNT(1)
  INTO V_CANT_PRO_FIC_SIS
  FROM
    (SELECT SISTEMA ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_SISTEMA RESPON
    FROM
      (SELECT
        /*+ CHOOSE */
        COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT
          /*+ ORDERED */
          VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_BITACORA_SIN_PROYECTOS BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      WHERE T.RESPONSABLE_SISTEMA   = V_USUARIO
      OR T.RESPONSABLE_COORDINACION = V_USUARIO
      )
    GROUP BY SISTEMA,
      RESPONSABLE_SISTEMA
    );
  -- CANTIDAD INDICADORES PENDIENTES POR GESTIONAR (SISTEMAS)
  SELECT COUNT(1)
  INTO V_CANT_IND_PEN_SIS
  FROM
    (SELECT SISTEMA ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_SISTEMA RESPONSABLE
    FROM
      (SELECT
        /*+ CHOOSE */
        COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT
          /*+ ORDERED */
          VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_INDICADOR_PENDIENTE BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      )
    GROUP BY SISTEMA,
      RESPONSABLE_SISTEMA
    );
  -- CANTIDAD INDICADORES PENDIENTES POR GESTIONAR (COORDINACION)
  SELECT COUNT(1)
  INTO V_CANT_IND_PEN_COO
  FROM
    (SELECT COORD COORDINACION ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_COORDINACION RESPONSABLE
    FROM
      (SELECT COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_INDICADOR_PENDIENTE BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      WHERE T.RESPONSABLE_SISTEMA   = V_USUARIO
      OR T.RESPONSABLE_COORDINACION = V_USUARIO
      )
    GROUP BY COORD,
      RESPONSABLE_COORDINACION
    );
ELSE
  -- PROYECTOS NUEVOS POR COORDINACION
  SELECT COUNT(1)
  INTO V_CANT_PRO_COO
  FROM
    ( SELECT DISTINCT
      /*+ CHOOSE*/
      G.COORDINACION,
      c.RESPONSABLE,
      COUNT(1) CANTIDAD
    FROM BIT_DETALLE D
    INNER JOIN BIT_PROYECTOS P
    ON P.PRY_REF           = TRIM(REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(D.IDENTREGABLE,C_A,C_B),C_C,C_D),C_E,C_F))
    AND P.PRY_REF         IS NOT NULL
    AND P.PRY_REF         &lt;> '0'
    AND (P.PROYECTO       IS NULL
    OR P.AREA_SOLICITANTE IS NULL
    OR P.PRIORIDAD        IS NULL
    OR P.NEGOCIO2         IS NULL)
    INNER JOIN BIT_SISTEMAS S
    ON S.SISTEMAS=D.SISTEMAS
    LEFT JOIN BIT_REL_SISTEMAS_GERENCIA g
    ON G.SISTEMAS=S.SISTEMAS
    LEFT JOIN BIT_COORDINACION c
    ON C.COORD=G.COORDINACION
    GROUP BY G.COORDINACION,
      c.RESPONSABLE
    );
  -- ACTIVIDADES DETALLES PENDIENTES POR GESTION DE PRY, BOLSA O FRENTE COORDINACION
  SELECT COUNT(1)
  INTO V_CANT_GES_PRY_COO
  FROM
    (SELECT
      /*+ RULE*/
      COR.COORD NOMBRE_COORDINACION,
      COR.RESPONSABLE RESPONSABLE_COR,
      COUNT(1) CANTIDAD
    FROM BIT_DETALLE DET
    INNER JOIN BIT_SISTEMAS SIS
    ON(SIS.SISTEMAS=DET.SISTEMAS)
    INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
    ON (SISCOR.SISTEMAS = SIS.SISTEMAS)
    INNER JOIN BIT_COORDINACION COR
    ON (COR.COORD      = SISCOR.COORDINACION)
    WHERE (DET.FRENTE IS NULL
    OR DET.BOLSA      IS NULL
    OR DET.PRY        IS NULL)
    GROUP BY COR.COORD,
      COR.RESPONSABLE
    );
  -- ACTIVIDADES DETALLES PENDIENTES POR GESTION DE PRY, BOLSA O FRENTE SISTEMAS
  SELECT COUNT(1)
  INTO V_CANT_GES_PRY_SIS
  FROM
    (SELECT NOMBRE_SISTEMAS,
      RESPONSABLESIS,
      COUNT(1) CANTIDAD
    FROM
      (SELECT
        /*+ ORDERED */
        COR.COORD NOMBRE_COORDINACION,
        COR.RESPONSABLE RESPONSABLE_COR,
        SIS.SISTEMAS NOMBRE_SISTEMAS ,
        SIS.RESPONSABLE RESPONSABLESIS
      FROM BIT_DETALLE DET
      INNER JOIN BIT_SISTEMAS SIS
      ON(SIS.SISTEMAS=DET.SISTEMAS)
      INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
      ON (SISCOR.SISTEMAS = SIS.SISTEMAS)
      INNER JOIN BIT_COORDINACION COR
      ON (COR.COORD      = SISCOR.COORDINACION)
      WHERE (DET.FRENTE IS NULL
      OR DET.BOLSA      IS NULL
      OR DET.PRY        IS NULL)
      )
    GROUP BY NOMBRE_SISTEMAS,
      RESPONSABLESIS
    );
  -- COMBINACION DE COSTOS POR CREAR
  SELECT COUNT(1)
  INTO V_CANT_COST_NEW
  FROM
    ( SELECT DISTINCT
      /*+ RULE*/
      BOLSA,
      PRY,
      PROVEEDOR ,
    FROM BIT_DETALLE
      FRENTE,
      ANIO,
      TIPO
    MINUS
    SELECT DISTINCT
      /*+ RULE*/
      BOLSA,
      PRY,
      PROVEEDOR ,
      FRENTE,
      ANIO,
      TIPO
    FROM BIT_COSTOS
    );
  -- PROYECTOS SIN FICHAS RELACIONADAS (SISTEMAS)
  SELECT COUNT(1)
  INTO V_CANT_PRO_FIC_SIS
  FROM
    (SELECT SISTEMA ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_SISTEMA RESPONSABLE
    FROM
      (SELECT
        /*+ CHOOSE */
        COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT
          /*+ ORDERED */
          VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_BITACORA_SIN_PROYECTOS BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      )
    GROUP BY SISTEMA,
      RESPONSABLE_SISTEMA
    );
  -- CANTIDAD INDICADORES PENDIENTES POR GESTIONAR (SISTEMAS)
  SELECT COUNT(1)
  INTO V_CANT_IND_PEN_SIS
  FROM
    (SELECT SISTEMA ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_SISTEMA RESPONSABLE
    FROM
      (SELECT
        /*+ CHOOSE */
        COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT
          /*+ ORDERED */
          VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_INDICADOR_PENDIENTE BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      WHERE T.RESPONSABLE_SISTEMA   = V_USUARIO
      OR T.RESPONSABLE_COORDINACION = V_USUARIO
      )
    GROUP BY SISTEMA,
      RESPONSABLE_SISTEMA
    );
  -- CANTIDAD INDICADORES PENDIENTES POR GESTIONAR (COORDINACION)
  SELECT COUNT(1)
  INTO V_CANT_IND_PEN_COO
  FROM
    (SELECT COORD COORDINACION ,
      SUM(TOTAL) TOTAL,
      RESPONSABLE_COORDINACION RESPONSABLE
    FROM
      (SELECT
        /*+ CHOOSE */
        COORDINACION ,
        TOTAL ,
        SISTEMA ,
        RESPONSABLE_SISTEMA ,
        COORD ,
        RESPONSABLE_COORDINACION
      FROM
        (SELECT
          /*+ ORDERED */
          VISTA.COORDINACION,
          VISTA.TOTAL,
          SIS.SISTEMAS SISTEMA,
          SIS.RESPONSABLE RESPONSABLE_SISTEMA,
          COR.COORD,
          COR.RESPONSABLE RESPONSABLE_COORDINACION
        FROM
          (SELECT BSP.COORDINACION,
            COUNT(1) TOTAL
          FROM BIT_INDICADOR_PENDIENTE BSP
          GROUP BY BSP.COORDINACION
          ) VISTA
        INNER JOIN BIT_SISTEMAS SIS
        ON SIS.SISTEMAS = VISTA.COORDINACION
        INNER JOIN BIT_REL_SISTEMAS_GERENCIA SISCOR
        ON SISCOR.SISTEMAS = SIS.SISTEMAS
        INNER JOIN BIT_COORDINACION COR
        ON COR.COORD = SISCOR.COORDINACION
        ) T
      )
    GROUP BY COORD,
      RESPONSABLE_COORDINACION
    );
END IF;
-- PROYECTOS SIN FICHAS RELACIONADAS (COORDINACION)
IF V_CANT_PRO_FIC_SIS > 0 AND (V_COOR_PRINCIPAL != '' OR V_PERFIL = 'ADMINISTRADOR') THEN
  V_CANT_PRO_FIC_COO := V_CANT_PRO_FIC_SIS;
END IF;
-- CANTIDAD INDICADORES PENDIENTES POR GESTIONAR (COORDINACION)
IF V_CANT_IND_PEN_COO > 0 AND (V_COOR_PRINCIPAL != '' OR V_PERFIL = 'ADMINISTRADOR') THEN
  V_CANT_IND_PEN_COO := V_CANT_IND_PEN_COO;
ELSE
  V_CANT_IND_PEN_COO := 0;
END IF;
-- Cantidad proyectos nuevos
IF V_CANT_PRO_SIS > 0 OR V_CANT_PRO_COO > 0 THEN
  V_NUM_ALERTAS  := V_NUM_ALERTAS + 1;
END IF;
-- Cantidad actividades pendientes por gestion de pry, bolsa o frente
IF V_CANT_GES_PRY_SIS > 0 OR V_CANT_GES_PRY_COO > 0 THEN
  V_NUM_ALERTAS      := V_NUM_ALERTAS + 1;
END IF;
-- Cantidad costos por crear
IF V_CANT_COST_NEW > 0 THEN
  V_NUM_ALERTAS   := V_NUM_ALERTAS + 1;
END IF;
-- Cantidad proyectos sin fichas relacionadas
IF V_CANT_PRO_FIC_SIS > 0 OR V_CANT_PRO_FIC_COO >0 THEN
  V_NUM_ALERTAS      := V_NUM_ALERTAS + 1;
END IF;
-- -- Cantidad indicadores pendientes por gestionar
IF V_CANT_IND_PEN_SIS > 0 OR V_CANT_IND_PEN_COO >0 THEN
  V_NUM_ALERTAS      := V_NUM_ALERTAS + 1;
END IF;
-- CONSTRUCCION DE LAS ALERTAS
V_ALERTAS := V_NUM_ALERTAS||'|'||V_CANT_PRO_SIS||'|'||V_CANT_PRO_COO||'|'||V_CANT_GES_PRY_SIS||'|'||V_CANT_GES_PRY_COO||'|' ||V_CANT_COST_NEW||'|'||V_CANT_PRO_FIC_SIS||'|'||V_CANT_PRO_FIC_COO||'|'||V_CANT_IND_PEN_SIS||'|' ||V_CANT_IND_PEN_COO;
RETURN V_ALERTAS;
END VALIDACION_ALERTAS_FN;

</pre>
</div>
</div>
</div>
</body>
</html>
