<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="DF_HORAS_EXTRAS_PKG/report.js" type="text/javascript"></script>
<link href="DF_HORAS_EXTRAS_PKG/report.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="banner">
<table width="98%"><tr>
<td><h2 class="banner">DF_HORAS_EXTRAS_PKG</h2></td>
</tr></table></div>
<div id="maintabs">
<div class="currentmaintab" onclick="onSelectMainTab(this, 0)">
<div>
<p>Doc</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 1)">
<div>
<p>Details</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 2)">
<div>
<p>Grants</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 3)">
<div>
<p>References</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 4)">
<div>
<p>Dependencies</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 5)">
<div>
<p>Code</p>
</div>
</div>
</div>
<br/>
<div id="masterreports">
<div id="Master.0">
<div class="currentmasterreport">
<TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE><HR><P>----------------------------------------------------------------------------------------------------------------------<BR>    Nombre        : DF_Horas_Extras_PKG<BR>    Tipo          : Paquete<BR>    Objetivo      : Calcular el detalle de hora extras<BR>    Realizado Por : CINTE - Manuel Benítez Fajardo<BR>    Fecha: Fecha  : 2020-09-17<BR>  ------------------------------------------------------------------------------------------------------------------------</P><HR><TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE></div>
</div>
<div id="Master.1">
<div class="masterreport">
<table id="Table.0" cellpadding="0" cellspacing="0" summary="">
<th>NAME</th>
<th>VALUE</th>
</tr>
<tr>
<td>OWNER</td>
<td>PDB_CRONUS</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>DF_HORAS_EXTRAS_PKG</td>
</tr>
<tr>
<td>SUBOBJECT_NAME</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_ID</td>
<td>80332</td>
</tr>
<tr>
<td>DATA_OBJECT_ID</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_TYPE</td>
<td>PACKAGE&nbsp;BODY</td>
</tr>
<tr>
<td>CREATED</td>
<td>13/07/22</td>
</tr>
<tr>
<td>LAST_DDL_TIME</td>
<td>23/02/25</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>2025-02-23:23:03:24</td>
</tr>
<tr>
<td>STATUS</td>
<td>VALID</td>
</tr>
<tr>
<td>TEMPORARY</td>
<td>N</td>
</tr>
<tr>
<td>GENERATED</td>
<td>N</td>
</tr>
<tr>
<td>SECONDARY</td>
<td>N</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>2</td>
</tr>
<tr>
<td>EDITION_NAME</td>
<td>null</td>
</tr>
<tr>
<td>SHARING</td>
<td>NONE</td>
</tr>
<tr>
<td>EDITIONABLE</td>
<td>Y</td>
</tr>
<tr>
<td>ORACLE_MAINTAINED</td>
<td>N</td>
</tr>
<tr>
<td>APPLICATION</td>
<td>N</td>
</tr>
<tr>
<td>DEFAULT_COLLATION</td>
<td>null</td>
</tr>
<tr>
<td>DUPLICATED</td>
<td>N</td>
</tr>
<tr>
<td>SHARDED</td>
<td>N</td>
</tr>
<tr>
<td>CREATED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>CREATED_VSNID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_VSNID</td>
<td>null</td>
</tr>
</table>
</div>
</div>
<div id="Master.2">
<div class="masterreport">
<table id="Table.1" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>PRIVILEGE</th>
<th>GRANTEE</th>
<th>GRANTABLE</th>
<th>GRANTOR</th>
<th>OBJECT_NAME</th>
</tr>
</table>
</div>
</div>
<div id="Master.3">
<div class="masterreport">
<table id="Table.2" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.4">
<div class="masterreport">
<table id="Table.3" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.5">
<div class="masterreport">
<pre>
PACKAGE BODY              "DF_HORAS_EXTRAS_PKG" IS
  /*----------------------------------------------------------------------------------------------------------------------
    Nombre        : DF_Horas_Extras_PKG
    Tipo          : Paquete
    Objetivo      : Calcular el detalle de hora extras
    Realizado Por : CINTE - Manuel Benítez Fajardo
    Fecha: Fecha  : 2020-09-17
  ------------------------------------------------------------------------------------------------------------------------*/

  CURSOR Cur_Rango_Horas IS
      SELECT *
        FROM DF_Extra_Tipo
    ORDER BY HIni
  ;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Crear_Detalle_Novedad
    Tipo             : Procedimiento
    Description      : Dado un ID de Novedad crear el registro de detalle
    Parametros       : inID_Novedad     : ID del registro a novedad que es referenciado en el registro de detalle de novedad

                       inHoras_Normal               : Cantidad de Horas Normales
                       inHoras_Extra                : Cantidad de Horas Extras
                       inHoras_Extra_Nocturno       : Cantidad de Horas Extras Nocturnas
                       inHoras_Extra_Nocturno_MD    : Cantidad de Horas Extras Nocturnas Madrugada
                       inHoras_Festivo              : Cantidad de Horas Domingo o Festivas Diurnas
                       inHoras_Festivo_Nocturno     : Cantidad de Horas Domingo o Festivas Nocturnas
                       inHoras_Festivo_Nocturno_MD  : Cantidad de Horas Domingo o Festivas Nocturnas Madrugada
                       inHoras_Sabado               : Cantidad de Horas Sabado Diurnas
                       inHoras_Sabado_Nocturno      : Cantidad de Horas Sabado Nocturnas
                       inHoras_Sabado_Nocturno_MD   : Cantidad de Horas Sabado Nocturnas Madrugada

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/

  PROCEDURE PR_Crear_Detalle_Novedad (
     inID_Novedad                   IN    DF_Novedad.ID%TYPE
    ,inHoras_Normal                 IN    DF_Detalles_Novedad.Horas_Normal%TYPE
    ,inHoras_Extra                  IN    DF_Detalles_Novedad.Horas_Extra%TYPE
    ,inHoras_Extra_Nocturno         IN    DF_Detalles_Novedad.Horas_Extra_Nocturno%TYPE
    ,inHoras_Extra_Nocturno_MD      IN    DF_Detalles_Novedad.Horas_Extra_Nocturno_MD%TYPE
    ,inHoras_Extra_Madrugada        IN    DF_Detalles_Novedad.Horas_Extra_Madrugada%TYPE
    ,inHoras_Festivo                IN    DF_Detalles_Novedad.Horas_Festivo%TYPE
    ,inHoras_Festivo_Nocturno       IN    DF_Detalles_Novedad.Horas_Festivo_Nocturno%TYPE
    ,inHoras_Festivo_Nocturno_MD    IN    DF_Detalles_Novedad.Horas_Festivo_Nocturno_MD%TYPE
    ,inHoras_Sabado                 IN    DF_Detalles_Novedad.Horas_Sabado%TYPE
    ,inHoras_Sabado_Nocturno        IN    DF_Detalles_Novedad.Horas_Sabado_Nocturno%TYPE
    ,inHoras_Sabado_Nocturno_MD     IN    DF_Detalles_Novedad.Horas_Sabado_Nocturno_MD%TYPE
    ,inTotal_Horas_Bruto            IN    DF_Detalles_Novedad.Total_Horas_Bruto%TYPE
    ,inTotal_Horas_Neto             IN    DF_Detalles_Novedad.Total_Horas_Neto%TYPE
  ) IS
  BEGIN
    INSERT INTO DF_DETALLES_NOVEDAD (
       ID_Detalle_Novedad
      ,ID_Novedad
      ,Horas_Normal
      ,Horas_Extra
      ,Horas_Extra_Nocturno
      ,Horas_Extra_Nocturno_MD
      ,Horas_Extra_Madrugada
      ,Horas_Festivo
      ,Horas_Festivo_Nocturno
      ,Horas_Festivo_Nocturno_MD
      ,Horas_Sabado
      ,Horas_Sabado_Nocturno
      ,Horas_Sabado_Nocturno_MD
      ,Total_Horas_Bruto
      ,Total_Horas_Neto
    ) VALUES (
       DF_DETALLES_NOVEDAD_SEQ.NextVal
      ,inID_Novedad
      ,inHoras_Normal
      ,inHoras_Extra
      ,inHoras_Extra_Nocturno
      ,inHoras_Extra_Nocturno_MD
      ,inHoras_Extra_Madrugada
      ,inHoras_Festivo
      ,inHoras_Festivo_Nocturno
      ,inHoras_Festivo_Nocturno_MD
      ,inHoras_Sabado
      ,inHoras_Sabado_Nocturno
      ,inHoras_Sabado_Nocturno_MD
      ,inTotal_Horas_Bruto
      ,inTotal_Horas_Neto
    );

  END PR_Crear_Detalle_Novedad;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Actualizar_Detalle_Novedad
    Tipo             : Procedimiento
    Description      : Dado un ID de Novedad Actualizar el registro de detalle
    Parametros       : inID_Novedad     : ID del registro a novedad que es referenciado en el registro de detalle de novedad

                       inHoras_Normal               : Cantidad de Horas Normales
                       inHoras_Extra                : Cantidad de Horas Extras
                       inHoras_Extra_Nocturno       : Cantidad de Horas Extras Nocturnas
                       inHoras_Extra_Nocturno_MD    : Cantidad de Horas Extras Nocturnas Madrugada
                       inHoras_Festivo              : Cantidad de Horas Domingo o Festivas Diurnas
                       inHoras_Festivo_Nocturno     : Cantidad de Horas Domingo o Festivas Nocturnas
                       inHoras_Festivo_Nocturno_MD  : Cantidad de Horas Domingo o Festivas Nocturnas Madrugada
                       inHoras_Sabado               : Cantidad de Horas Sabado Diurnas
                       inHoras_Sabado_Nocturno      : Cantidad de Horas Sabado Nocturnas
                       inHoras_Sabado_Nocturno_MD   : Cantidad de Horas Sabado Nocturnas Madrugada

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Actualizar_Detalle_Novedad (
     inID_Novedad                   IN    DF_Novedad.ID%TYPE
    ,inHoras_Normal                 IN    DF_Detalles_Novedad.Horas_Normal%TYPE
    ,inHoras_Extra                  IN    DF_Detalles_Novedad.Horas_Extra%TYPE
    ,inHoras_Extra_Nocturno         IN    DF_Detalles_Novedad.Horas_Extra_Nocturno%TYPE
    ,inHoras_Extra_Nocturno_MD      IN    DF_Detalles_Novedad.Horas_Extra_Nocturno_MD%TYPE
    ,inHoras_Extra_Madrugada        IN    DF_Detalles_Novedad.Horas_Extra_Madrugada%TYPE
    ,inHoras_Festivo                IN    DF_Detalles_Novedad.Horas_Festivo%TYPE
    ,inHoras_Festivo_Nocturno       IN    DF_Detalles_Novedad.Horas_Festivo_Nocturno%TYPE
    ,inHoras_Festivo_Nocturno_MD    IN    DF_Detalles_Novedad.Horas_Festivo_Nocturno_MD%TYPE
    ,inHoras_Sabado                 IN    DF_Detalles_Novedad.Horas_Sabado%TYPE
    ,inHoras_Sabado_Nocturno        IN    DF_Detalles_Novedad.Horas_Sabado_Nocturno%TYPE
    ,inHoras_Sabado_Nocturno_MD     IN    DF_Detalles_Novedad.Horas_Sabado_Nocturno_MD%TYPE
    ,inTotal_Horas_Bruto            IN    DF_Detalles_Novedad.Total_Horas_Bruto%TYPE
    ,inTotal_Horas_Neto             IN    DF_Detalles_Novedad.Total_Horas_Neto%TYPE
  )  IS
  BEGIN

    UPDATE DF_Detalles_Novedad
       SET  Horas_Normal              = inHoras_Normal
           ,Horas_Extra               = inHoras_Extra
           ,Horas_Extra_Nocturno      = inHoras_Extra_Nocturno
           ,Horas_Extra_Nocturno_MD   = inHoras_Extra_Nocturno_MD
           ,Horas_Extra_Madrugada     = inHoras_Extra_Madrugada
           ,Horas_Festivo             = inHoras_Festivo
           ,Horas_Festivo_Nocturno    = inHoras_Festivo_Nocturno
           ,Horas_Festivo_Nocturno_MD = inHoras_Festivo_Nocturno_MD
           ,Horas_Sabado              = inHoras_Sabado
           ,Horas_Sabado_Nocturno     = inHoras_Sabado_Nocturno
           ,Horas_Sabado_Nocturno_MD  = inHoras_Sabado_Nocturno_MD
           ,Total_Horas_Bruto         = NVL (inTotal_Horas_Bruto, Total_Horas_Bruto)
           ,Total_Horas_Neto          = NVL (inTotal_Horas_Neto , Total_Horas_Neto)
           ,Fecha_Actualizacion = SYSDATE
     WHERE ID_Novedad = inID_Novedad
    ;

  END PR_Actualizar_Detalle_Novedad;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : FN_Obtener_Detalle_Novedad
    Tipo             : Funcion
    Description      : Dado un ID de Novedad, obtener el registro de detalle
    Parametros       : inID_Novedad     : ID del registro a novedad que es referenciado en el registro de detalle de novedad
    Retorna          : el registro con el ID dado
     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-23 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  FUNCTION FN_Obtener_Detalle_Novedad (
     inID_Novedad                   IN    DF_Novedad.ID%TYPE
  ) RETURN DF_Detalles_Novedad%ROWTYPE IS
   v_Rec_Detalles_Novedad           DF_Detalles_Novedad%ROWTYPE;
  BEGIN
   SELECT *
     INTO v_Rec_Detalles_Novedad
     FROM DF_Detalles_Novedad
    WHERE ID_Novedad = inID_Novedad
   ;

   RETURN v_Rec_Detalles_Novedad;
  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      RETURN v_Rec_Detalles_Novedad;
  END FN_Obtener_Detalle_Novedad;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : FN_Es_Festivo
    Tipo             : Funcion
    Description      : Dada una fecha determinar si es o no un dia festivo
    Parametros       : inFecha                    : Fecha base de la evaluacion
    Retorna          : Si es o no un dia festivo
                       1 - SI
                       0 - NO

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  FUNCTION FN_Es_Festivo (
    inFecha                         IN     DATE
  ) RETURN NUMBER IS
    v_Es_Festivo                    NUMBER(1);
  BEGIN
    SELECT NVL (MAX (DF_Horas_Extras_PKG.CONST_SI), DF_Horas_Extras_PKG.CONST_NO)
      INTO v_Es_Festivo
      FROM df_calendariofechas
     WHERE TRUNC (FECHA) = TRUNC (inFecha)
    ;

    RETURN v_Es_Festivo;
  END FN_Es_Festivo;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : FN_Obtener_Iniciales_Dia
    Tipo             : Funcion
    Description      : Dada una fecha determinar a que iniciales corresponde
    Parametros       : inFecha                    : Fecha base de la evaluacion
    Retorna          : un valor que corresponde a una de las  constante en el paquete DF_Horas_Extras_PKG
                         Const_Lunes            LUN
                         Const_Martes           MAR
                         Const_Miercoles        MIÉ
                         Const_Jueves           JUE
                         Const_Viernes          VIE
                         Const_Sabado           SÁB
                         Const_Domingo          DOM


     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-23 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  FUNCTION FN_Obtener_Iniciales_Dia (
    inFecha                         IN     DATE
  ) RETURN DF_Extra_Tipo.Dia%TYPE IS
    v_Iniciales_Dia                 DF_Extra_Tipo.Dia%TYPE;
  BEGIN
    v_Iniciales_Dia := SubStr (trim (to_char(inFecha ,'DAY','NLS_DATE_LANGUAGE=SPANISH')), 1, 3);
    IF FN_Es_Festivo (inFecha) = DF_Horas_Extras_PKG.CONST_SI THEN
      v_Iniciales_Dia := 'DOM';
    END IF;

    RETURN v_Iniciales_Dia;

  END FN_Obtener_Iniciales_Dia;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : FN_Obtener_Tipo_Hora
    Tipo             : Funcion
    Description      : Dada una fecha determinar el Tipo Hora al que corresponde
    Parametros       : inFecha                    : Fecha base de la evaluacion
    Retorna          : un valor de a 1 a 11 que corresponde a una de constante en el paquete DF_Horas_Extras_PKG
                         CONST_Hr_Normal                  1
                         CONST_Hr_Extra                   2
                         CONST_Hr_Extra_Nocturno          3
                         CONST_Hr_Extra_Nocturno_MD       4
                         CONST_Hr_Extra_Madrugada         5
                         CONST_Hr_Festivo                 6
                         CONST_Hr_Festivo_Nocturno        7
                         CONST_Hr_Festivo_Nocturno_MD     8
                         CONST_Hr_Sabado                  9
                         CONST_Hr_Sabado_Nocturno        10
                         CONST_Hr_Sabado_Nocturno_MD     11

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-23 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  FUNCTION FN_Obtener_Multiplicador (
    inFecha                         IN     DATE
  ) RETURN NUMBER IS
    v_Multiplicador                 NUMBER;
    v_Dia                           DF_Extra_Tipo.Dia%TYPE;
  BEGIN
    v_Multiplicador := 0;

    v_Dia := SubStr (trim (to_char(inFecha ,'DAY','NLS_DATE_LANGUAGE=SPANISH')), 1, 3);
    IF FN_Es_Festivo (inFecha) = DF_Horas_Extras_PKG.CONST_SI THEN
      v_Dia := 'DOM';
    END IF;

    SELECT Multiplicador
      INTO v_Multiplicador
      FROM DF_Extra_Tipo
     WHERE To_Date ('20000101 ' || To_Char (inFecha, 'HH24:MI:SS') , 'YYYYMMDD HH24:MI:SS') +
           CASE v_Dia
             WHEN 'SÁB' THEN 0
             WHEN 'DOM' THEN 1
             WHEN 'LUN' THEN 2
             WHEN 'MAR' THEN 3
             WHEN 'MIÉ' THEN 4
             WHEN 'JUE' THEN 5
             WHEN 'VIE' THEN 6
           END BETWEEN DF_Extra_Tipo.HINI AND DF_Extra_Tipo.HFIN
           FETCH FIRST 1 ROW ONLY
    ;

    RETURN v_Multiplicador;

  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      RETURN v_Multiplicador;
  END FN_Obtener_Multiplicador;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : FN_Obtener_Tipo_Hora
    Tipo             : Funcion
    Description      : Dada una fecha determinar el Tipo Hora al que corresponde
    Parametros       : inFecha                    : Fecha base de la evaluacion
    Retorna          : un valor de a 1 a 11 que corresponde a una de constante en el paquete DF_Horas_Extras_PKG
                         CONST_Hr_Normal                  1
                         CONST_Hr_Extra                   2
                         CONST_Hr_Extra_Nocturno          3
                         CONST_Hr_Extra_Nocturno_MD       4
                         CONST_Hr_Festivo_Nocturno_MD     8
                         CONST_Hr_Extra_Madrugada         5
                         CONST_Hr_Festivo                 6
                         CONST_Hr_Festivo_Nocturno        7
                         CONST_Hr_Sabado                  9
                         CONST_Hr_Sabado_Nocturno        10
                         CONST_Hr_Sabado_Nocturno_MD     11

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-23 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  FUNCTION FN_Obtener_Tipo_Hora (
    inFecha                         IN     DATE
  ) RETURN NUMBER IS
    v_Tipo_Hora                     NUMBER (2);
    v_Dia                           VARCHAR2 (3);
  BEGIN

    v_Dia := SubStr (trim (to_char(inFecha ,'DAY','NLS_DATE_LANGUAGE=SPANISH')), 1, 3);
    IF FN_Es_Festivo (inFecha) = DF_Horas_Extras_PKG.CONST_SI THEN
      v_Dia := 'DOM';
    END IF;

    SELECT CASE DF_Extra_Tipo.Tipo_Extra
             WHEN CONST_Str_Normal              THEN CONST_Hr_Normal
             WHEN CONST_Str_Extra               THEN CONST_Hr_Extra
             WHEN CONST_Str_Extra_Nocturno      THEN CONST_Hr_Extra_Nocturno
             WHEN CONST_Str_Extra_Nocturno_MD   THEN CONST_Hr_Extra_Nocturno_MD
             WHEN CONST_Str_Extra_Madrugada     THEN CONST_Hr_Extra_Madrugada
             WHEN CONST_Str_Festivo             THEN CONST_Hr_Festivo
             WHEN CONST_Str_Festivo_Nocturno    THEN CONST_Hr_Festivo_Nocturno
             WHEN CONST_Str_Festivo_Nocturno_MD THEN CONST_Hr_Festivo_Nocturno_MD
             WHEN CONST_Str_Sabado              THEN CONST_Hr_Sabado
             WHEN CONST_Str_Sabado_Nocturno     THEN CONST_Hr_Sabado_Nocturno
             WHEN CONST_Str_Sabado_Nocturno_MD  THEN CONST_Hr_Sabado_Nocturno_MD
           END
      INTO v_Tipo_Hora
      FROM DF_Extra_Tipo
     WHERE To_Date ('20000101 ' || To_Char (inFecha, 'HH24:MI:SS') , 'YYYYMMDD HH24:MI:SS') +
           CASE v_Dia
             WHEN 'SÁB' THEN 0
             WHEN 'DOM' THEN 1
             WHEN 'LUN' THEN 2
             WHEN 'MAR' THEN 3
             WHEN 'MIÉ' THEN 4
             WHEN 'JUE' THEN 5
             WHEN 'VIE' THEN 6
           END BETWEEN DF_Extra_Tipo.HINI AND DF_Extra_Tipo.HFIN
           FETCH FIRST 1 ROW ONLY
    ;

    RETURN v_Tipo_Hora;

  EXCEPTION
    WHEN NO_DATA_FOUND THEN
      RETURN v_Tipo_Hora;

  END FN_Obtener_Tipo_Hora;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Calcular_Cantidad_Horas
    Tipo             : Procedimiento
    Description      : Dados un rango de horas del mismo dia
                       Calcula la cantidad de horas por cada uno de los rangos de horas de establecidos:
    Parametros       : inFecha_Inicial            : Fecha inicio del rango a trabajar
                       inFecha_Final              : Fecha Final del rango a trabajar

                                                    -- Formato HH24:MI:SS
                       inDesde_Normal             : Hora de Inicio del Rango de Horas Normales
                       inHasta_Normal             : Hora de Final del Rango de Horas Normales
                       inDesde_Extra              : Hora de Inicio del Rango de Horas Extras
                       inHasta_Extra              : Hora de Final del Rango de Horas Extras
                       inDesde_Extra_Nocturno     : Hora de Inicio del Rango de Horas Extras Nocturno
                       inHasta_Extra_Nocturno     : Hora de Final del Rango de Horas Extras Nocturno
                       inDesde_Extra_Nocturno_MD  : Hora de Inicio del Rango de Horas Extras Nocturnas Madrugada
                       inHasta_Extra_Nocturno_MD  : Hora de Final del Rango de  Horas Extras Nocturnas Madrugada

                       outQ_Horas_Normal            : Cantidad de Horas Normales
                       outQ_Horas_Extra             : Cantidad de Horas Extras
                       outQ_Horas_Extra_Nocturno    : Cantidad de Horas Extras Nocturnas
                       outQ_Horas_Extra_Nocturno_MD : Cantidad de Horas Extras Nocturnas Madrugada

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-23 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Calcular_Cantidad_Horas (
     inFecha_Inicial                IN      DATE
    ,inFecha_Final                  IN      DATE
    ,inDesde_Normal                 IN      VARCHAR2
    ,inHasta_Normal                 IN      VARCHAR2
    ,inDesde_Extra                  IN      VARCHAR2
    ,inHasta_Extra                  IN      VARCHAR2
    ,inDesde_Extra_Nocturno         IN      VARCHAR2
    ,inHasta_Extra_Nocturno         IN      VARCHAR2
    ,inDesde_Extra_Nocturno_MD      IN      VARCHAR2
    ,outTbl_LQ_Detalle_Novedad          OUT Typ_Tbl_LQ_Detalle_Novedad
    ,inHasta_Extra_Nocturno_MD      IN      VARCHAR2
    ,inDesde_Extra_Madrugada        IN      VARCHAR2
    ,inHasta_Extra_Madrugada        IN      VARCHAR2
  ) IS
    v_Hora_Inicial                   VARCHAR2 (8);
    v_Hora_Final                     VARCHAR2 (8);

    v_Tbl_LQ_Detalle_Novedad         Typ_Tbl_LQ_Detalle_Novedad;

  BEGIN

    v_Hora_Inicial := TO_CHAR (inFecha_Inicial, 'HH24:MI:SS');
    v_Hora_Final   := TO_CHAR (inFecha_Final  , 'HH24:MI:SS');

    IF v_Hora_Inicial BETWEEN inDesde_Extra_Nocturno_MD AND inHasta_Extra_Nocturno_MD THEN
      -- las Horas Inicial esta en el rango de Extras Nocturnas dia Siguiente
      IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno_MD AND inHasta_Extra_Nocturno_MD THEN
        -- las Horas Final esta en el rango de Extras Nocturnas dia Siguiente
        -- todo el rango de horas es Extras Nocturnas dia Siguiente
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Tipo_Extra    := CONST_Str_Extra_Nocturno_MD;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Final    := inFecha_Final;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial) * 24, 2);

      ELSE
        -- Extras Nocturnas dia Siguiente

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Tipo_Extra    := CONST_Str_Extra_Nocturno_MD;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra_Nocturno_MD, 'YYYYMMDD HH24:MI:SS');
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Hora_Inicial) * 24, 2);

        IF v_Hora_Final BETWEEN inDesde_Extra_Madrugada AND inHasta_Extra_Madrugada THEN

          -- Extra_Madrugada
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Tipo_Extra    := CONST_Str_Extra_Madrugada;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Madrugada, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final    := inFecha_Final;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial) * 24, 2);

        ELSE

          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Tipo_Extra    := CONST_Str_Extra_Madrugada;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Madrugada, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra_Madrugada, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial) * 24, 2);

          IF v_Hora_Final BETWEEN inDesde_Normal AND inHasta_Normal THEN
            -- Diurnas
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Normal, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := inFecha_Final;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);

          ELSE
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Normal, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Normal, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);

            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);

            IF v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := inFecha_Final;
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

            ELSE
              -- Extras
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra, 'YYYYMMDD HH24:MI:SS');
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

              IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN

                v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Tipo_Extra    := CONST_Str_Extra_Nocturno;
                v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Nocturno, 'YYYYMMDD HH24:MI:SS');
                v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final    := inFecha_Final;
                v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial);
                v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial) * 24, 2);

              END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN */
            END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN */
          END IF; /* IF v_Hora_Final BETWEEN inDesde_Normal AND inHasta_Normal THEN */
        END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra_Madrugada AND inHasta_Extra_Madrugada THEN */
      END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno_MD AND inHasta_Extra_Nocturno_MD THEN */
    ELSIF v_Hora_Inicial BETWEEN inDesde_Extra_Madrugada AND inHasta_Extra_Madrugada THEN

      IF v_Hora_Final BETWEEN inDesde_Extra_Madrugada AND inHasta_Extra_Madrugada THEN
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Tipo_Extra    := CONST_Str_Extra_Madrugada;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final    := inFecha_Final;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial) * 24, 2);

      ELSE
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Tipo_Extra    := CONST_Str_Extra_Madrugada;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra_Madrugada, 'YYYYMMDD HH24:MI:SS');
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada).Hora_Inicial) * 24, 2);

        IF v_Hora_Final BETWEEN inDesde_Normal AND inHasta_Normal THEN
          -- Diurnas
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Normal, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := inFecha_Final;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);

        ELSE
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Normal, 'YYYYMMDD HH24:MI:SS');

          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Normal, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);
          IF v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN
             v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := inFecha_Final;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);
          ELSE
            -- Extras
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

            IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN

              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Tipo_Extra    := CONST_Str_Extra_Nocturno;
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Nocturno, 'YYYYMMDD HH24:MI:SS');
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final    := inFecha_Final;
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial);
              v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial) * 24, 2);

            END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN */
          END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN */
        END IF; /* IF v_Hora_Final BETWEEN inDesde_Normal AND inHasta_Normal THEN */
      END IF; /* IF v_Hora_Final BETWEEN inDesde_Extra_Madrugada AND inHasta_Extra_Madrugada THEN */
    ELSIF v_Hora_Inicial BETWEEN inDesde_Normal AND inHasta_Normal THEN
      -- las Horas Inicial esta en el rango de Diurnas
      IF v_Hora_Final BETWEEN inDesde_Normal AND inHasta_Normal THEN
        -- la Horas Final esta en el rango de Diurnas
        -- todo el rango de horas es Diurnas
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := inFecha_Final;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);

      ELSE
        -- Diurnas

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra    := CONST_Str_Normal;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Normal, 'YYYYMMDD HH24:MI:SS');
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Hora_Inicial) * 24, 2);

        IF v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN
          -- Extras
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := inFecha_Final;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

        ELSE
          -- Extras
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra, 'YYYYMMDD HH24:MI:SS');

          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);
          IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN

            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Tipo_Extra    := CONST_Str_Extra_Nocturno;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Nocturno, 'YYYYMMDD HH24:MI:SS');
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final    := inFecha_Final;
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial);
            v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial) * 24, 2);

          END IF;
        END IF;
      END IF;
    ELSIF v_Hora_Inicial BETWEEN inDesde_Extra AND inHasta_Extra THEN
      -- las Horas Inicial esta en el rango de Extras
      IF     v_Hora_Final BETWEEN inDesde_Extra AND inHasta_Extra THEN
        -- la Horas Final esta en el rango de Extras
        -- todo el rango de horas es Extras

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := inFecha_Final;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

      ELSE
        -- Extras

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra    := CONST_Str_Extra;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial  := inFecha_Inicial;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final    := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inHasta_Extra, 'YYYYMMDD HH24:MI:SS');
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial);
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Hora_Inicial) * 24, 2);

        IF v_Hora_Final BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN

          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Tipo_Extra    := CONST_Str_Extra_Nocturno;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial  := TO_DATE (TO_CHAR (inFecha_Inicial, 'YYYYMMDD') || ' ' || inDesde_Extra_Nocturno, 'YYYYMMDD HH24:MI:SS');
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final    := inFecha_Final;
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial);
          v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial) * 24, 2);

        END IF;
      END IF;
    ELSIF     v_Hora_Inicial BETWEEN inDesde_Extra_Nocturno AND inHasta_Extra_Nocturno THEN
      -- la Horas Inicial y Final estan en el rango de Extras Dia Actual
      -- todo el rango de horas es Extras Dia Actual

      v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Tipo_Extra    := CONST_Str_Extra_Nocturno;
      v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial  := inFecha_Inicial;
      v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final    := inFecha_Final;
      v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Multiplicador := FN_Obtener_Multiplicador (v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial);
      v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Numero_Horas  := ROUND ((v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Final - v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno).Hora_Inicial) * 24, 2);

    END IF;


    outTbl_LQ_Detalle_Novedad := v_Tbl_LQ_Detalle_Novedad;

  END PR_Calcular_Cantidad_Horas;
  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Obtener_Cantidad_Hora
    Tipo             : Procedimiento
    Description      : Dados un rango de horas  del mismo dia y con base en tipo de dia (Laboral, Sabado y festivo o Domingo)
                       Calcula la cantidad de horas por cada uno de los rangos de horas de establecidos:
                       - Diurna                 07:00:00 - 17:59:59
                       - Extra                  18:00:00 - 21:59:59
                       - Extra Dia Actual       22:00:00 - 23:59:59
                       - Extra Dia siguiente    00:00:00 - 06:59:59
    Parametros       : inFecha_Inicial          : Fecha inicio del rango a trabajar
                       inFecha_Final            : Fecha Final del rango a trabajar

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Obtener_Cantidad_Hora (
     inFecha_Inicial                 IN     DATE
    ,inFecha_Final                   IN     DATE
    ,outTbl_LQ_Detalle_Novedad          OUT Typ_Tbl_LQ_Detalle_Novedad
  ) IS

    v_No_Aplica                     NUMBER;
    v_Iniciales_Dia                 DF_Extra_Tipo.Dia%TYPE;

    v_Tbl_LQ_Detalle_Novedad        Typ_Tbl_LQ_Detalle_Novedad;
  BEGIN
    v_Iniciales_Dia := FN_Obtener_Iniciales_Dia (inFecha_Inicial);
    -- Las fechas Inicial y Final siempre estan en el MISMO DIA
    CASE
      WHEN v_Iniciales_Dia IN (Const_Lunes, Const_Martes, Const_Miercoles, Const_Jueves, Const_Viernes) THEN
        PR_Calcular_Cantidad_Horas (
           inFecha_Inicial
          ,inFecha_Final
          ,v_Desde_Normal                               -- inDesde_Normal
          ,v_Hasta_Normal                               -- inHasta_Normal
          ,v_Desde_Extra                                -- inDesde_Extra
          ,v_Hasta_Extra                                -- inHasta_Extra
          ,v_Desde_Extra_Nocturno                       -- inDesde_Extra_Nocturno
          ,v_Hasta_Extra_Nocturno                       -- inHasta_Extra_Nocturno
          ,v_Desde_Extra_Nocturno_MD                    -- inDesde_Extra_Nocturno_MD
          ,v_Hasta_Extra_Nocturno_MD                    -- inHasta_Extra_Nocturno_MD
          ,v_Desde_Extra_Madrugada                      -- inDesde_Extra_Nocturno_MD
          ,v_Hasta_Extra_Madrugada                      -- inHasta_Extra_Nocturno_MD
          ,v_Tbl_LQ_Detalle_Novedad                     -- outTbl_LQ_Detalle_Novedad
        );

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Normal) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Normal)            :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Extra)             :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra_Nocturno) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno)    :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra_Nocturno_MD) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD) :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra_Madrugada) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada) :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Madrugada);
        END IF;

      WHEN v_Iniciales_Dia = Const_Domingo THEN
        PR_Calcular_Cantidad_Horas (
           inFecha_Inicial
          ,inFecha_Final
          ,v_Desde_Festivo                               -- inDesde_Normal
          ,v_Hasta_Festivo                               -- inHasta_Normal
          ,v_Desde_Festivo_Nocturno                      -- inDesde_Extra
          ,v_Hasta_Festivo_Nocturno                      -- inHasta_Extra
          ,NULL                                          -- inDesde_Extra_Nocturno
          ,NULL                                          -- inHasta_Extra_Nocturno
          ,v_Desde_Festivo_Nocturno_MD                   -- inDesde_Extra_Nocturno_MD
          ,v_Hasta_Festivo_Nocturno_MD                   -- inHasta_Extra_Nocturno_MD
          ,NULL                                          -- inDesde_Extra_Madrugada
          ,NULL                                          -- inHasta_Extra_Madrugada
          ,v_Tbl_LQ_Detalle_Novedad                      -- outTbl_LQ_Detalle_Novedad
        );

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra               := CONST_Str_Festivo;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra                := CONST_Str_Festivo_Nocturno;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Tipo_Extra    := CONST_Str_Festivo_Nocturno_MD;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Normal) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Festivo)                        :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal);
        END IF;


        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Festivo_Nocturno)               :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra);
        END IF;
        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra_Nocturno_MD) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Festivo_Nocturno_MD)            :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD);
        END IF;

      WHEN  v_Iniciales_Dia = Const_Sabado THEN
        PR_Calcular_Cantidad_Horas (
           inFecha_Inicial
          ,inFecha_Final
          ,v_Desde_Sabado                                -- inDesde_Normal
          ,v_Hasta_Sabado                                -- inHasta_Normal
          ,v_Desde_Sabado_Nocturno                       -- inDesde_Extra
          ,v_Hasta_Sabado_Nocturno                       -- inHasta_Extra
          ,NULL                                          -- inDesde_Extra_Nocturno
          ,NULL                                          -- inHasta_Extra_Nocturno
          ,v_Desde_Sabado_Nocturno_MD                    -- inDesde_Extra_Nocturno_MD
          ,v_Hasta_Sabado_Nocturno_MD                    -- inHasta_Extra_Nocturno_MD
          ,NULL                                          -- inDesde_Extra_Madrugada
          ,NULL                                          -- inHasta_Extra_Madrugada
          ,v_Tbl_LQ_Detalle_Novedad                      -- outTbl_LQ_Detalle_Novedad
        );

        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal).Tipo_Extra               := CONST_Str_Sabado;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra).Tipo_Extra                := CONST_Str_Sabado_Nocturno;
        v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD).Tipo_Extra    := CONST_Str_Sabado_Nocturno_MD;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Normal) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Sabado)                         :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Normal);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Sabado_Nocturno)                :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra);
        END IF;

        IF v_Tbl_LQ_Detalle_Novedad.EXISTS (CONST_Hr_Extra_Nocturno_MD) THEN
          outTbl_LQ_Detalle_Novedad (CONST_Hr_Sabado_Nocturno_MD)             :=  v_Tbl_LQ_Detalle_Novedad (CONST_Hr_Extra_Nocturno_MD);
        END IF;

    END CASE;

  END PR_Obtener_Cantidad_Hora;


  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Obtener_Totales_Horas
    Tipo             : Procedimiento
    Description      : Dados un Tabla con el desglose de horas para un rango de fechas-hora
                       obtener los totales para cada tipo de hora, junto con el total bruto (antes de aplicar el multiplicador)
                       y el total neto (despues de aplicar el multiplicador)
    Parametros       : inTbl_LQ_Rango_Fecha          : Tabla con el desglose de horas para un rango de fechas-hora
                       outTot_Hr_Normal              : Total horas nomales
                       outTot_Hr_Extra               : Total horas Extras
                       outTot_Hr_Extra_Nocturno      : Total horas Extras Nocturnas
                       outTot_Hr_Extra_Nocturno_MD   : Total horas Extras Nocturnas Madrugada
                       outTot_Hr_Festivo             : Total horas Festivo o Domingo
                       outTot_Hr_Festivo_Nocturno    : Total horas Festivo o Domingo Nocturnas
                       outTot_Hr_Festivo_Nocturno_MD : Total horas Festivo o Domingo Nocturnas Madrugada
                       outTot_Hr_Sabado              : Total horas Sabado
                       outTot_Hr_Sabado_Nocturno     : Total horas Sabado Nocturno
                       outTot_Hr_Sabado_Nocturno_MD  : Total horas Sabado Nocturno Madrugada
                       outTot_Horas_Brutas           : Total horas Brutas
                       outTot_Horas_Netas            : Total horas Netas

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Obtener_Totales_Horas (
     inTbl_LQ_Rango_Fecha           IN     Typ_Tbl_LQ_Rango_Fecha
    ,outTot_Hr_Normal                  OUT NUMBER
    ,outTot_Hr_Extra                   OUT NUMBER
    ,outTot_Hr_Extra_Nocturno          OUT NUMBER
    ,outTot_Hr_Extra_Nocturno_MD       OUT NUMBER
    ,outTot_Hr_Extra_Madrugada         OUT NUMBER
    ,outTot_Hr_Festivo                 OUT NUMBER
    ,outTot_Hr_Festivo_Nocturno        OUT NUMBER
    ,outTot_Hr_Festivo_Nocturno_MD     OUT NUMBER
    ,outTot_Hr_Sabado                  OUT NUMBER
    ,outTot_Hr_Sabado_Nocturno         OUT NUMBER
    ,outTot_Hr_Sabado_Nocturno_MD      OUT NUMBER
    ,outTot_Horas_Brutas               OUT NUMBER
    ,outTot_Horas_Netas                OUT NUMBER
  ) IS

    v_Total_Hr_Normal               NUMBER;
    v_Total_Hr_Extra                NUMBER;
    v_Total_Hr_Extra_Nocturno       NUMBER;
    v_Total_Hr_Extra_Nocturno_MD    NUMBER;
    v_Total_Hr_Extra_Madrugada      NUMBER;
    v_Total_Hr_Sabado               NUMBER;
    v_Total_Hr_Festivo              NUMBER;
    v_Total_Hr_Festivo_Nocturno     NUMBER;
    v_Total_Hr_Festivo_Nocturno_MD  NUMBER;
    v_Total_Hr_Sabado_Nocturno      NUMBER;
    v_Total_Hr_Sabado_Nocturno_MD   NUMBER;

    v_Total_Horas_Brutas            NUMBER;
    v_Total_Horas_Netas             NUMBER;

    v_Multiplicador                 NUMBER;
    v_Numero_Horas                  NUMBER;
    v_Liquidacion_Horas             NUMBER;

    v_Index                         PLS_INTEGER;

    v_Jndex                         PLS_INTEGER;

  BEGIN
    v_Total_Hr_Normal               := 0;
    v_Total_Hr_Extra                := 0;
    v_Total_Hr_Extra_Nocturno       := 0;
    v_Total_Hr_Extra_Nocturno_MD    := 0;
    v_Total_Hr_Extra_Madrugada      := 0;
    v_Total_Hr_Festivo              := 0;
    v_Total_Hr_Festivo_Nocturno     := 0;
    v_Total_Hr_Festivo_Nocturno_MD  := 0;
    v_Total_Hr_Sabado               := 0;
    v_Total_Hr_Sabado_Nocturno      := 0;
    v_Total_Hr_Sabado_Nocturno_MD   := 0;

    v_Total_Horas_Brutas            := 0;
    v_Total_Horas_Netas             := 0;


    v_Index := inTbl_LQ_Rango_Fecha.FIRST;

    WHILE v_Index &lt;= inTbl_LQ_Rango_Fecha.LAST LOOP

      v_Jndex := inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha.FIRST;

      WHILE v_Jndex &lt;= inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha.LAST LOOP

        v_Multiplicador := inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha (v_Jndex).Multiplicador;

        v_Numero_Horas  := NVL (inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha (v_Jndex).Numero_Horas, 0);

        v_Liquidacion_Horas := v_Numero_Horas * (1 + v_Multiplicador);

        IF v_Multiplicador > 0 THEN

          v_Total_Horas_Brutas := v_Total_Horas_Brutas + v_Numero_Horas;
          v_Total_Horas_Netas  := v_Total_Horas_Netas  + v_Liquidacion_Horas;

          CASE inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha (v_Jndex).Tipo_Extra
            WHEN CONST_Str_Normal THEN
              v_Total_Hr_Normal         := v_Total_Hr_Normal + v_Liquidacion_Horas;
            WHEN CONST_Str_Extra THEN
              v_Total_Hr_Extra          := v_Total_Hr_Extra + v_Liquidacion_Horas;
            WHEN CONST_Str_Extra_Nocturno THEN
              v_Total_Hr_Extra_Nocturno := v_Total_Hr_Extra_Nocturno + v_Liquidacion_Horas;
            WHEN CONST_Str_Extra_Nocturno_MD THEN
              v_Total_Hr_Extra_Nocturno_MD := v_Total_Hr_Extra_Nocturno_MD + v_Liquidacion_Horas;
            WHEN CONST_Str_Extra_Madrugada THEN
              v_Total_Hr_Extra_Madrugada := v_Total_Hr_Extra_Madrugada + v_Liquidacion_Horas;
            WHEN CONST_Str_Festivo THEN
              v_Total_Hr_Festivo := v_Total_Hr_Festivo + v_Liquidacion_Horas;
            WHEN CONST_Str_Festivo_Nocturno THEN
              v_Total_Hr_Festivo_Nocturno := v_Total_Hr_Festivo_Nocturno + v_Liquidacion_Horas;
            WHEN CONST_Str_Festivo_Nocturno_MD THEN
              v_Total_Hr_Festivo_Nocturno_MD := v_Total_Hr_Festivo_Nocturno_MD + v_Liquidacion_Horas;
            WHEN CONST_Str_Sabado THEN
              v_Total_Hr_Sabado := v_Total_Hr_Sabado + v_Liquidacion_Horas;
            WHEN CONST_Str_Sabado_Nocturno THEN
              v_Total_Hr_Sabado_Nocturno := v_Total_Hr_Sabado_Nocturno + v_Liquidacion_Horas;
            WHEN CONST_Str_Sabado_Nocturno_MD THEN
              v_Total_Hr_Sabado_Nocturno_MD := v_Total_Hr_Sabado_Nocturno_MD + v_Liquidacion_Horas;
          END CASE;
        END IF;

        v_Jndex := inTbl_LQ_Rango_Fecha (v_Index).LQ_Rango_Fecha.NEXT (v_Jndex);
      END LOOP;

      v_Index := inTbl_LQ_Rango_Fecha.NEXT (v_Index);

    END LOOP;

    outTot_Hr_Normal              := v_Total_Hr_Normal;
    outTot_Hr_Extra               := v_Total_Hr_Extra;
    outTot_Hr_Extra_Nocturno      := v_Total_Hr_Extra_Nocturno;
    outTot_Hr_Extra_Nocturno_MD   := v_Total_Hr_Extra_Nocturno_MD;
    outTot_Hr_Extra_Madrugada     := v_Total_Hr_Extra_Madrugada;
    outTot_Hr_Festivo             := v_Total_Hr_Festivo;
    outTot_Hr_Festivo_Nocturno    := v_Total_Hr_Festivo_Nocturno;
    outTot_Hr_Festivo_Nocturno_MD := v_Total_Hr_Festivo_Nocturno_MD;
    outTot_Hr_Sabado              := v_Total_Hr_Sabado;
    outTot_Hr_Sabado_Nocturno     := v_Total_Hr_Sabado_Nocturno;
    outTot_Hr_Sabado_Nocturno_MD  := v_Total_Hr_Sabado_Nocturno_MD;

    outTot_Horas_Brutas           := v_Total_Horas_Brutas;
    outTot_Horas_Netas            := v_Total_Horas_Netas;

  END PR_Obtener_Totales_Horas;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Calcular_Horas_Extras
    Tipo             : Procedimiento
    Description      : Dados un ID de Novedad y un rango de fecha calcula y acumula la cantidad de horas por cada
                       uno de los rangos de horas de establecidos:
                       - Diurna                 07:00:00 - 17:59:59
                       - Extra                  18:00:00 - 21:59:59
                       - Extra Dia Actual       22:00:00 - 23:59:59
                       inFecha_Final     : Fecha Final del rango a trabajar
                       - Extra Dia siguiente    00:00:00 - 06:59:59
    Parametros       : inID_Novedad      : ID del registro a desglosar
                       inFecha_Inicial   : Fecha inicio del rango a trabajar

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Calcular_Horas_Extras (
     inID_Novedad                   IN     DF_Novedad.ID%TYPE
    ,inFecha_Inicial                IN     DF_Novedad.Ini_Novedad%TYPE
    ,inFecha_Final                  IN     DF_Novedad.Fin_Novedad%TYPE
  ) IS

    v_Fecha_Inicial                 DF_Novedad.Ini_Novedad%TYPE;

    v_Fecha_Final                   DF_Novedad.Ini_Novedad%TYPE;

    v_Existe                        NUMBER (1);

    v_Total_Hr_Normal               NUMBER;
    v_Total_Hr_Extra                NUMBER;
    v_Total_Hr_Extra_Nocturno       NUMBER;
    v_Total_Hr_Extra_Nocturno_MD    NUMBER;
    v_Total_Hr_Extra_Madrugada      NUMBER;
    v_Total_Hr_Festivo              NUMBER;
    v_Total_Hr_Festivo_Nocturno     NUMBER;
    v_Total_Hr_Festivo_Nocturno_MD  NUMBER;
    v_Total_Hr_Sabado               NUMBER;
    v_Total_Hr_Sabado_Nocturno      NUMBER;
    v_Total_Hr_Sabado_Nocturno_MD   NUMBER;

    v_Total_Horas_Brutas            NUMBER;
    v_Total_Horas_Netas             NUMBER;

    v_Tbl_LQ_Detalle_Novedad        Typ_Tbl_LQ_Detalle_Novedad;
    v_Tbl_LQ_Rango_Fecha            Typ_Tbl_LQ_Rango_Fecha;

    v_Indice                        PLS_INTEGER;

  BEGIN

    v_Fecha_Inicial := inFecha_Inicial;
    v_Fecha_Final   := inFecha_Final;

    v_Indice := 1;
    WHILE v_Fecha_Inicial &lt; inFecha_Final LOOP
      IF v_Fecha_Final > TO_DATE (TO_CHAR (v_Fecha_Inicial, 'YYYYMMDD') || ' ' || '23:59:59', 'YYYYMMDD HH24:MI:SS') THEN

        PR_Obtener_Cantidad_Hora (
           v_Fecha_Inicial
          ,TO_DATE (TO_CHAR (v_Fecha_Inicial, 'YYYYMMDD') || ' ' || '23:59:59', 'YYYYMMDD HH24:MI:SS')
          ,v_Tbl_LQ_Detalle_Novedad
        );

        v_Tbl_LQ_Rango_Fecha (v_Indice).Fecha_Inicial  := v_Fecha_Inicial;
        v_Tbl_LQ_Rango_Fecha (v_Indice).Fecha_Final    := TO_DATE (TO_CHAR (v_Fecha_Inicial, 'YYYYMMDD') || ' ' || '23:59:59', 'YYYYMMDD HH24:MI:SS');
        v_Tbl_LQ_Rango_Fecha (v_Indice).LQ_Rango_Fecha := v_Tbl_LQ_Detalle_Novedad;

        v_Indice := v_Indice + 1;

        v_Fecha_Inicial := TO_DATE (TO_CHAR (v_Fecha_Inicial + 1, 'YYYYMMDD') || ' ' || '00:00:00', 'YYYYMMDD HH24:MI:SS');
      ELSE
        PR_Obtener_Cantidad_Hora (
           v_Fecha_Inicial
          ,v_Fecha_Final
          ,v_Tbl_LQ_Detalle_Novedad
        );

        v_Tbl_LQ_Rango_Fecha (v_Indice).Fecha_Inicial  := v_Fecha_Inicial;
        v_Tbl_LQ_Rango_Fecha (v_Indice).Fecha_Final    := v_Fecha_Final;
        v_Tbl_LQ_Rango_Fecha (v_Indice).LQ_Rango_Fecha := v_Tbl_LQ_Detalle_Novedad;

        v_Indice := v_Indice + 1;

        v_Fecha_Inicial := v_Fecha_Final;

      END IF;

    END LOOP;

    PR_Obtener_Totales_Horas (
       v_Tbl_LQ_Rango_Fecha
      ,v_Total_Hr_Normal
      ,v_Total_Hr_Extra
      ,v_Total_Hr_Extra_Nocturno
      ,v_Total_Hr_Extra_Nocturno_MD
      ,v_Total_Hr_Extra_Madrugada
      ,v_Total_Hr_Festivo
      ,v_Total_Hr_Festivo_Nocturno
      ,v_Total_Hr_Festivo_Nocturno_MD
      ,v_Total_Hr_Sabado
      ,v_Total_Hr_Sabado_Nocturno
      ,v_Total_Hr_Sabado_Nocturno_MD
      ,v_Total_Horas_Brutas
      ,v_Total_Horas_Netas
    );

    SELECT NVL (MAX (CONST_SI), CONST_NO)
      INTO v_Existe
      FROM DF_Detalles_Novedad
     WHERE ID_Novedad = inID_Novedad
       AND estado = CONST_Estado_Activo
    ;

    IF v_Existe = CONST_NO THEN
      PR_Crear_Detalle_Novedad (
         inID_Novedad
        ,v_Total_Hr_Normal
        ,v_Total_Hr_Extra
        ,v_Total_Hr_Extra_Nocturno
        ,v_Total_Hr_Extra_Nocturno_MD
        ,v_Total_Hr_Extra_Madrugada
        ,v_Total_Hr_Festivo
        ,v_Total_Hr_Festivo_Nocturno
        ,v_Total_Hr_Festivo_Nocturno_MD
        ,v_Total_Hr_Sabado
        ,v_Total_Hr_Sabado_Nocturno
        ,v_Total_Hr_Sabado_Nocturno_MD
        ,v_Total_Horas_Brutas
        ,v_Total_Horas_Netas
      );
    ELSE
      PR_Actualizar_Detalle_Novedad (
         inID_Novedad
        ,v_Total_Hr_Normal
        ,v_Total_Hr_Extra
        ,v_Total_Hr_Extra_Nocturno
        ,v_Total_Hr_Extra_Nocturno_MD
        ,v_Total_Hr_Extra_Madrugada
        ,v_Total_Hr_Festivo
        ,v_Total_Hr_Festivo_Nocturno
        ,v_Total_Hr_Festivo_Nocturno_MD
        ,v_Total_Hr_Sabado
        ,v_Total_Horas_Netas
        ,v_Total_Hr_Sabado_Nocturno
        ,v_Total_Hr_Sabado_Nocturno_MD
        ,v_Total_Horas_Brutas
      );
    END IF;

  END PR_Calcular_Horas_Extras;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Procesar_Horas_Extras
    Tipo             : Procedimiento
    Description      : Procesar los registro de novedades con tipo de novedad 23 - Trabajo Fuera de Horario Laboral - EXTRA
    Parametros       : inID_Novedad - Opcional -

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Procesar_Horas_Extras(
     inID_Novedad                   IN    DF_Novedad.ID%TYPE                   DEFAULT NULL
  ) IS
    CURSOR Cur_Novedades IS
       SELECT *
         FROM DF_NOVEDAD
                LEFT OUTER JOIN DF_DETALLES_NOVEDAD
                  ON     DF_DETALLES_NOVEDAD.ID_Novedad = DF_Novedad.ID
                     AND DF_DETALLES_NOVEDAD.Estado = CONST_Estado_Activo
        WHERE Tipo_Novedad IN (23)
          AND Aprobado = 1
          AND ID = NVL (inID_Novedad, ID)
          AND DF_NOVEDAD.Estado = CONST_Estado_Activo
    ;
  BEGIN
    FOR Datos IN Cur_Novedades LOOP
      DF_Horas_Extras_PKG.PR_Calcular_Horas_Extras (
         Datos.ID                            -- inIDNovedad
        ,Datos.Ini_Novedad                   -- inFecha_Inicial
        ,Datos.Fin_Novedad                   -- inFecha_Final
      );
    END LOOP;
  END PR_Procesar_Horas_Extras;

  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Procesar_Horas_Extras
    Tipo             : Procedimiento
    Description      : Dado el ID del Registro de novedad, obtener el detalle de las horas extras
    Parametros       : inID_Novedad       ID del registro de novedad a Procesar
                       inIni_Novedad      Fecha en que inicia la novedad
                       inFin_Novedad      Fecha en la finaliza la novedad
     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Procesar_Horas_Extras(
     inID_Novedad                   IN    DF_Novedad.ID%TYPE
    ,inIni_Novedad                  IN    DF_Novedad.Ini_Novedad%TYPE
    ,inFin_Novedad                  IN    DF_Novedad.Fin_Novedad%TYPE
    ,inAprobado                     IN    DF_Novedad.Aprobado%TYPE
  ) IS
  BEGIN
    IF inAprobado = df_horas_extras_pkg.CONST_SI THEN
      DF_Horas_Extras_PKG.PR_Calcular_Horas_Extras (
         inID_Novedad                    -- inIDNovedad
        ,inIni_Novedad                   -- inFecha_Inicial
        ,inFin_Novedad                   -- inFecha_Final
      );
    END IF;

  END PR_Procesar_Horas_Extras;
  /*----------------------------------------------------------------------------------------------------------------------
    Nombre           : PR_Borrar_Horas_Extras
    Tipo             : Procedimiento
    Description      : Dado el ID de la novedad, hacer el borrado logico del registro de detalle de ese registro de novedad
    Parametros       : inID_Novedad      ID del registro de novedad a borrar

     F E C H A             A U T O R            OBJETIVO
    ---------- ------------------------------- ----------------------------------------------------------------------------
    2020-09-17 CINTE - Manuel Benítez Fajardo  Creacion
  ------------------------------------------------------------------------------------------------------------------------*/
  PROCEDURE PR_Borrar_Horas_Extras (
     inID_Novedad                   IN    DF_Novedad.ID%TYPE
  ) IS
  BEGIN
    UPDATE DF_DETALLES_NOVEDAD
       SET  Estado = CONST_Estado_Borrado
           ,Fecha_Actualizacion = SYSDATE
     WHERE ID_Novedad = inID_Novedad
    ;
  END PR_Borrar_Horas_Extras;
  /*------------------------------------------------------------------------------------------------------------------------*/
BEGIN
  FOR Datos IN Cur_Rango_Horas LOOP
    CASE Datos.Tipo_Extra
      WHEN CONST_Str_Normal THEN
        v_Desde_Normal              := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Normal              := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Extra THEN
        v_Desde_Extra               := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Extra               := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Extra_Nocturno THEN
        v_Desde_Extra_Nocturno      := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Extra_Nocturno      := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Extra_Nocturno_MD THEN
        v_Desde_Extra_Nocturno_MD   := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Extra_Nocturno_MD   := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Extra_Madrugada THEN
        v_Desde_Extra_Madrugada     := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Extra_Madrugada     := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Festivo THEN
        v_Desde_Festivo             := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Festivo             := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Festivo_Nocturno THEN
        v_Desde_Festivo_Nocturno    := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Festivo_Nocturno    := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Festivo_Nocturno_MD THEN
        v_Desde_Festivo_Nocturno_MD := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Festivo_Nocturno_MD := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Sabado THEN
        v_Desde_Sabado              := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Sabado              := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Sabado_Nocturno THEN
        v_Desde_Sabado_Nocturno     := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Sabado_Nocturno     := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
      WHEN CONST_Str_Sabado_Nocturno_MD THEN
        v_Desde_Sabado_Nocturno_MD  := TO_CHAR (Datos.HIni, 'HH24:MI:SS');
        v_Hasta_Sabado_Nocturno_MD  := TO_CHAR (Datos.HFin, 'HH24:MI:SS');
    END CASE;
  END LOOP;

END DF_HORAS_EXTRAS_PKG;</pre>
</div>
</div>
</div>
</body>
</html>
